https://www.youtube.com/live/6GAdqOZx9z0?si=xtSClfd4vfz0c5kL

Основные идеи в докладе:
- Тесты это тоже код.
- Любой код со временем становится только сложнее.
- Сложность можно нивелировать вводя абстракции.

Простой пример простейшего теста. Уже видны все основные этапы AAA:
- Arrange
- Act
- Assert

![Пример](img.png)

Рассмотрим как постепенно усложняются тесты. Вот пример тестирования 
рендеринга страницы регистрации.

![Проверка рендеринга страницы регистрации](img_1.png)

А теперь рассмотрим тест самой регистрации:

![img](img_2.png)

Соответственно здесь нам надо сгенерировать кучу данных которые вводит пользователь
и проверить их и то что создала сама система. И здесь есть ряд вопрос: обязательно ли
год рождения должен быть таким. Может ли зарегистрироваться только CTO или нет. Можно ли
зарегистрироваться с другим номером телефона и тд. А еще мы не проверяем что сохранился адрес.
А еще не проверяем сохранился ли номер телефона.

Решение как убрать сложность: разнести ее по функциям. Отдельно создаем фабрику случайных данных

![img](img_3.png)

Описываем схему данных этой фабрики: Что она принимает и что возвращает.

![img](img_4.png)

А чтобы не вызывать пачку вложенных функций сделаем фикстуру с данными по-умолчанию:

![img](img_5.png)

С генерацией данных разобрались и теперь уберем ассерты.

![img](img_6.png)

Нюанс в том что чтобы получить ожидаемые из сгенерированных данных. Для этого нужно написать фабрику-преобразователь/конвертер.

![img](img_7.png)

Соответственно фабрика user_data принимает регистрационные данные (RegistrationData) и возвращает их преобразованный вариант: UserData.
Далее делаем к этой фабрике пару протоколов:

![img](img_8.png)

Обратите внимание: мы изменили реализацию RegistrationData отнаследовав от UserData
Итог:

![img](img_9.png)

Получившийся код может расширяться. Вернемся к фабрике регистрационных данных. 

![img](img_3.png)

И допустим у нас будет 2 типа пользователей. Один такой полный, а другой зарегистрировался по промоакции и у него никаких полей нет. 
Но при этом они будут работать одинаково. Тогда мы параметризуем тест инструментами pytest и определяем такую фабрику
нового пользователя:

![img](img_10.png)

Теперь более реальный пример с использованием API. Допустим нам надо замокать внешний сервис. Мы модифицировать старую фикстуру
или написать новую:

![img](img_11.png)

Затем пишем мок внутри фикстуры:

![img](img_12.png)

httpretty - специальная библиотека для мока веб-сокетов.

Итог:

![img](img_13.png)


education.borshev.com/python-testing